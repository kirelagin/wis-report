Сохранение позиций токенов
--------------------------

На странице с результатами поиска найденные ключевые слова подсвечиваются и выводятся с некоторым окружающим их контекстом.
Для реализации этой функции необходимо каким-то образом
сохранять информацию о том, в каком именно месте документа встречается это ключевое слово.

Мы начали с того, что хранили в коллекции документов текст в токенизированном виде (в виде списка токенов). При этом в индекс
вместе с основой слова записывался номер токена в списке. Соответственно, код, отображающий результаты, собирал
исходный текст из токенов, подсвечивая те, которые соответствуют ключевым словам из запроса.

Быстро выяснилось, что такой способ довольно неудобен. Основная проблема заключается в том, что по списку токенов невозможно
восстановить исходный текст: попытка просто разделять токены пробелами приводит к очень плохому результату: текст выглядит
некрасиво, поскольку вся пунктуация оказывается отбита пробелами с обеих сторон.


Токены как пары номеров символов
--------------------------------

Стало очевидно, что необходимо сохранять в коллекцию текст в исходном виде (не считая предобработки, удаляющей разметку).
Теперь чтобы подсветить некоторый токен необходимо знать его начальную и конечную позиции в тексте. Таким образом,
в индекс по-прежнему сохраняется номер токена в списке, а в коллекцию — токенизированный текст в форме список пар целых чисел (начальная и конечная позиции).
Мы также рассматривали возможность не хранить токенизацию текста в коллекции для экономии места, но это привело бы
к необходимости токенизировать каждый текст заново при выводе страницы результатов, что неизбежно сказалось бы
на времени ожидания формирования этой страницы.


Вывод результатов
-----------------

При выводе результатов для каждого слова находится контекст фиксированного (по числу токенов) размера. В получившемся списке диапазонов
позиций выполняется слияние пересекающихся элементов. Затем диапазоны заменяются на соответствующие строки из полного текста статьи
и все вхождения ключевых слов отображаются функцией подсветки. Данная обработка выполняется в поисковой библиотеке и не привязана
к веб-фронтенду, что позволило, в частности, создать консольный поисковый клиент для удобства разработки.
